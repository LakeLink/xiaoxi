<!--pages/feed/index.wxml-->
<view style="padding-bottom: 20px;">
    <view class="card" wx:key="_id" wx:for="{{ weRunDetails }}" style="margin-bottom: 20px;">
        <swiper style=" height: 200px;" indicator-dots="{{ item.images.length > 1 }}">
            <swiper-item wx:for="{{item.images}}" wx:for-index="imgId" wx:for-item="imgItem">
                <image src="{{imgItem}}" mode="aspectFill" style="width: 100%;  border-top-left-radius: 8px; border-top-right-radius: 8px;" data-id="{{index}}" data-imgId="{{imgId}}" bindtap="onImgTap"></image>
            </swiper-item>
        </swiper>
        <view style="padding: 10px;">
            <text class="title">{{item.exerciseType}} </text>
            <text class="author">@{{item.authorInfo.nickname}}</text>
            <text style="margin-left: 12px; color: grey; font-size: small;">{{item.when}} - {{item.location}}</text>
            <rich-text class="content">{{item.textContent}} </rich-text>


            <view wx:if="{{item.comments.length > 7 && !showAllComments}}" style="margin-top: 12px; margin-bottom: 4px; margin-left: 8px; font-size: small; color: grey;" bindtap="onShowEarlier">······ 更早 {{item.comments.length-7}} / {{item.comments.length}}</view>
            <view style="margin-top: 8px;">
                <view wx:for="{{item.comments}}" wx:for-item="c">
                    <view wx:if="{{ index >= item.comments.length-7 || showAllComments }}">
                        <text style="color: rgb(88, 183, 214);">{{item.commentUserInfo[c.userIndex].nickname}}：</text>
                        <text>{{c.content}}</text>
                    </view>
                </view>
            </view>

            <view wx:if="{{showCommentInput}}" style="display: flex; align-items: center; margin-top: 8px">
                <input style="background: #07070707; padding: 6px; margin-right: 4px; border-radius: 4px; flex-grow: 1;" focus="true" placeholder="说点什么..." model:value="{{newComment}}" />
                <button data-id="{{item._id}}" bindtap="onSubmitComment" style="display: inline" size="mini" type="primary" loading="{{sendingComment}}">发送</button>
            </view>

            <view class="action">
                <view style="flex-grow: 1; display:flex; justify-content:space-around; ">
                    <button size="mini" style="margin: 0" bindtap="onLike" data-idx="{{index}}">
                        <block wx:if="{{item.alreadyLiked}}">
                            <van-icon style="color: red;" name="like" />
                            <text wx:if="{{item.likedBy.length}}" style="margin-left: 5px; color: pink;">{{item.likedBy.length}}</text>
                        </block>
                        <block wx:else>
                            <van-icon style="color: pink;" name="like" />
                            <text wx:if="{{item.likedBy.length}}" style="margin-left: 5px; color: grey;">{{item.likedBy.length}}</text>
                        </block>
                    </button>
                    <button size="mini" bindtap="onComment" data-id="{{item._id}}" style="margin: 0;">
                        <van-icon name="smile-comment-o"></van-icon>
                        <text wx:if="{{item.comments.length}}" style="margin-left: 5px; color: grey;">{{item.comments.length}}</text>
                    </button>
                    <button size="mini" bindtap="onShare" data-id="{{item._id}}" style="margin: 0; height: 100%;">
                        <van-icon name="share-o" />
                    </button>
                </view>
            </view>
        </view>
    </view>
    <text style="display: block;color: grey; text-align: center; white-space: pre;">———— 已经到底了 ————</text>
</view>

<navigator url="/pages/exercise-now/create">
    <van-icon class="add" size="20px" name="plus" />
</navigator>

<!-- <van-button icon="star-o" type="primary" /> -->