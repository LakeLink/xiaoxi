<!--pages/stats/feast/canteen.wxml-->
<wxs module="util">
    var parseTime = function (t) {
        switch (t) {
            case 1:
                return "早餐"
                break;
            case 2:
                return "中餐"
                break;
            case 3:
                return "晚餐"
                break
            case 4:
                return "夜宵"
            default:
                return ""
                break;
        }
    }
    module.exports = {
        parseTime: parseTime
    };
</wxs>
<view class="safe-area-nobar">
    <view class="full-screen">
        <view class="canteen">
            <t-image width="72" height="72"></t-image>
            <view class="canteen--title">
                <text style="font-weight: bold; font-size: larger;">{{canteen.name}}</text>
                <!-- 5/5 -->
            </view>
            <view class="canteen--meta">
                <view class="canteen--rate">
                    环境 5/5
                    <t-rate value="5" gap="0" size="16" />
                </view>
                <view class="canteen--rate">
                    服务 5/5
                    <t-rate value="5" gap="0" size="16" />
                </view>
                <view class="canteen--rate">
                    美食 {{canteen.foodAvgRating}}/5
                    <t-rate value="{{canteen.foodAvgRating}}" gap="0" size="16" allow-half="true" />
                </view>
            </view>
        </view>
        <t-dropdown-menu>
            <t-dropdown-item options="{{$f.post.topics}}" value="{{topicValue}}" bindchange="onTopicChange" />
            <t-dropdown-item options="{{$f.post.sorters}}" value="{{sorterValue}}" bindchange="onSorterChange" />
        </t-dropdown-menu>
        <view class="side-bar-wrapper">
            <t-side-bar value="{{sideBarIndex}}" bind:change="onSideBarChange">
                <t-side-bar-item wx:for="{{categories}}" wx:key="index" value="{{item.value || index}}" label="{{item.label}}" badge-props="{{item.badgeProps}}" />
            </t-side-bar>
            <scroll-view class="content" scroll-y scroll-with-animation scroll-top="{{scrollTop}}" bind:scroll="onScroll">
                <view wx:for="{{windows}}" wx:for-item="w" wx:key="index" class="section">
                    <view class="title">{{w.name}}</view>
                    <view wx:for="{{w.foods}}" class="food" bind:tap="onTapFood" data-id="{{item._id}}" data-window="{{w.name}}">
                        <view class="food--image">
                            <view wx:if="{{item.time}}" class="food--time">{{util.parseTime(item.time)}}</view>
                            <t-image src="{{item.image}}" width="72" height="72"></t-image>
                        </view>
                        <view class="food--meta">
                            <text class="food--title">{{item.name}}</text>
                            <view class="food--meta--lower">
                                <view>
                                    <t-rate value="{{item.avgRating}}" gap="0" size="16" />
                                    <text>"awsl"</text>
                                </view>
                                <text>￥{{item.price}}</text>
                            </view>
                        </view>
                    </view>
                </view>
            </scroll-view>
        </view>
    </view>
    <t-fab style="right: 32rpx; bottom: calc(var(--bottom-safe-area) + 32rpx);" icon="gamepad-1" text="Lucky" bind:click="onTapLucky"></t-fab>
</view>